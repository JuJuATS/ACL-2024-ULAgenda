<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifier un préréglage</title>
</head>
<body>
    <h1>Modifier le préréglage</h1>

    <% if (flash.success && flash.success.length > 0) { %>
        <div class="flash-success">
            <% flash.success.forEach(function(msg) { %>
                <p><%= msg %></p>
            <% }) %>
        </div>
    <% } %>

    <% if (flash.error && flash.error.length > 0) { %>
        <div class="flash-error">
            <% flash.error.forEach(function(msg) { %>
                <p><%= msg %></p>
            <% }) %>
        </div>
    <% } %>

    <!-- Formulaire pour modifier le préréglage -->
    <form id="presetForm" action="/presets/<%= id %>?_method=PUT" method="POST">

        <label for="name">Nom :</label>
        <input type="text" id="name" name="name" required><br>

        <label for="color">Couleur :</label>
        <input type="color" id="color" name="color"><br>

        <label for="priority">Priorité :</label>
        <select id="priority" name="priority">
            <option value="Haute">Haute</option>
            <option value="Moyenne">Moyenne</option>
            <option value="Basse">Basse</option>
        </select><br>

        <label for="recurrence">Récurrence :</label>
        <select id="recurrence" name="recurrence">
            <option value="Aucune">Aucune</option>
            <option value="Quotidienne">Quotidienne</option>
            <option value="Hebdomadaire">Hebdomadaire</option>
            <option value="Mensuelle">Mensuelle</option>
            <option value="Annuelle">Annuelle</option>
        </select><br>

        <label for="duration">Durée par défaut (en minutes) :</label>
        <input type="number" id="duration" name="duration"><br>

        <label for="description">Description :</label>
        <textarea id="description" name="description"></textarea><br>

        <button type="submit">Mettre à jour</button>
    </form>

    <a href="/presets">Retourner à la liste</a>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const presetId = '<%= id %>';
                const response = await fetch(`/presets/api/${presetId}`);

                if (response.ok) {
                    const preset = await response.json();

                    // Remplir les champs avec les données reçues
                    document.getElementById('name').value = preset.name;
                    document.getElementById('color').value = preset.color;
                    document.getElementById('priority').value = preset.priority;
                    document.getElementById('recurrence').value = preset.recurrence;
                    document.getElementById('duration').value = preset.duration;
                    document.getElementById('description').value = preset.description || '';
                } else {
                    console.error('Erreur lors de la récupération du préréglage.');
                }
            } catch (error) {
                console.error('Erreur de communication avec le serveur :', error);
            }
        });
    </script>
</body>
</html>
